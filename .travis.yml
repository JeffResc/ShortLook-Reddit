os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
  - brew update
  - brew install dpkg ldid
  - git clone --recursive git://github.com/theos/theos.git ~/theos
script:
  - "export VERSION=$(grep 'Version: ' control | sed 's/^.*: //')"
  - "export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)"
  - "export FILENAME='packages/'\"$(grep 'Package: ' control | sed 's/^.*: //')\"'_'\"$VERSION\"'_iphoneos-arm.deb'"
  - make package
before_deploy:
  - git config --local user.name "Jeff Rescignano"
  - git config --local user.email "jeff@jeffresc.com"
  - git tag -a v$VERSION -m "$DESCRIPTION"
deploy:
  provider: releases
  api_key:
    secure: ifglsdtUDKO/4EErSeqqbGSSG7ORl1K2yd8zh/p3sJYyzskkQ3ms9iO4zQiIeXT2v5OvMx5Txqm3XVAn310kavYl4c6W/jT2UHOzleTkyccR0XAdEj8CS2DZSvDs3ccOHxWebmVVMtYnGV1Y0WwYCimRPyHkV03P34aZcwgrqczcukEYdRbiPBKOMlzXxl6jY49RQag+6nlf/F9q/IRzH5YZLfDMNUHhqdbndcp5Gv3y6g+8N+iHEi+w140o/torqmpv+1fzLjnhmF7YEKXWolqXGIFKkMZU+tpJxdy01ejhdACkDTSDVjulE6SkqNoLpxwMLRKO9BGR5bi/b1WJV8bJCEzP86EDu5+ij9Fx4ipSwNi6nMI80XeCnEL4Ay+sLYgJRz92RLyjfNBgMNBNpZqn8e9mpHdkT/rziQs2Muvi2FNo1TI2Na6RV5TO0WZVgNr4n/SaD8K+pBwrzJywEiDHwVbPR0tz49rhlwjA4TepsiBtoUoZO1YHe8OXLWKfOS3Dlc3s47I/XkuHhWbrVtIHy0MjCtUjxwE3LQ29RYmPCXlqS0V+Bq0qpk8ZZyf6bJu+vvtepTpWTwKbfWGJVU2CEcmZNcoNYpKObeK1YT+KvYLQiKoRhzPAqCu4kDHtYiJG0uh27R3ysWw10IQIypyY1wyZZrMK38JbH8+Wnag=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - release
